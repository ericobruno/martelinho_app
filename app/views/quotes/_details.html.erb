<div id="quote_details">
  <div class="row">
    <!-- Quote Information -->
    <div class="col-lg-8">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-info-circle"></i>
            Informações do Orçamento
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h6 class="text-muted mb-1">Cliente</h6>
              <p class="mb-3">
                <%= link_to quote.customer.name, customer_path(quote.customer), 
                    class: "text-decoration-none fw-bold" %>
              </p>
              
              <% if quote.vehicle %>
                <h6 class="text-muted mb-1">Veículo</h6>
                <p class="mb-3">
                  <%= link_to "#{quote.vehicle.license_plate} - #{quote.vehicle.vehicle_brand.name} #{quote.vehicle.vehicle_model.name}", 
                      vehicle_path(quote.vehicle), class: "text-decoration-none fw-bold" %>
                </p>
              <% end %>
              
              <h6 class="text-muted mb-1">Data de Criação</h6>
              <p class="mb-0"><%= quote.created_at.strftime("%d/%m/%Y às %H:%M") %></p>
            </div>
            
            <div class="col-md-6">
              <h6 class="text-muted mb-1">Status</h6>
              <p class="mb-3">
                <%= render "quotes/status_badge", quote: quote %>
              </p>
              
              <h6 class="text-muted mb-1">Valor Total</h6>
              <p class="mb-3 fs-4 fw-bold text-primary">
                R$ <%= number_with_delimiter(quote.total_price_cents / 100.0, delimiter: '.', separator: ',') %>
              </p>
              
              <% if quote.status == 'approved' %>
                <%= link_to "Criar Ordem de Serviço", new_quote_work_order_path(quote), 
                    class: "btn btn-success" %>
              <% end %>
            </div>
          </div>
          
          <% if quote.notes.present? %>
            <hr>
            <h6 class="text-muted mb-1">Descrição</h6>
            <p class="mb-0"><%= simple_format(quote.notes) %></p>
          <% end %>
        </div>
      </div>

      <!-- Quote Items -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-list"></i>
            Itens do Orçamento
          </h5>
        </div>
        <div class="card-body">
          <% if quote.quote_items.any? %>
            <!-- Desktop Table View -->
            <div class="d-none d-md-block">
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead class="table-light">
                    <tr>
                      <th scope="col">Serviço</th>
                      <th scope="col" class="text-center">Qtd</th>
                      <th scope="col" class="text-end">Valor Unit.</th>
                      <th scope="col" class="text-end">Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% quote.quote_items.each do |item| %>
                      <tr>
                        <td><%= item.service_type.name %></td>
                        <td class="text-center"><%= item.quantity %></td>
                        <td class="text-end">
                          R$ <%= number_with_delimiter(item.unit_price_cents / 100.0, delimiter: '.', separator: ',') %>
                        </td>
                        <td class="text-end fw-bold">
                          R$ <%= number_with_delimiter(item.total_price_cents / 100.0, delimiter: '.', separator: ',') %>
                        </td>
                      </tr>
                    <% end %>
                  </tbody>
                  <tfoot class="table-light">
                    <tr>
                      <th colspan="3" class="text-end">Total Geral:</th>
                      <th class="text-end fs-5">
                        R$ <%= number_with_delimiter(quote.total_price_cents / 100.0, delimiter: '.', separator: ',') %>
                      </th>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>

            <!-- Mobile Card View -->
            <div class="d-md-none">
              <% quote.quote_items.each do |item| %>
                <div class="card mb-2">
                  <div class="card-body py-2">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <strong><%= item.service_type.name %></strong>
                        <br>
                        <small class="text-muted">Qtd: <%= item.quantity %></small>
                      </div>
                      <div class="text-end">
                        <div class="fw-bold">
                          R$ <%= number_with_delimiter(item.total_price_cents / 100.0, delimiter: '.', separator: ',') %>
                        </div>
                        <small class="text-muted">
                          R$ <%= number_with_delimiter(item.unit_price_cents / 100.0, delimiter: '.', separator: ',') %> cada
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
              
              <div class="card bg-light">
                <div class="card-body py-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <strong>Total Geral:</strong>
                    <strong class="fs-5 text-primary">
                      R$ <%= number_with_delimiter(quote.total_price_cents / 100.0, delimiter: '.', separator: ',') %>
                    </strong>
                  </div>
                </div>
              </div>
            </div>
          <% else %>
            <div class="text-center py-4">
              <i class="fas fa-list fa-2x text-muted mb-3"></i>
              <h6 class="text-muted">Nenhum item adicionado</h6>
              <p class="text-muted">Edite o orçamento para adicionar itens.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Actions Sidebar -->
    <div class="col-lg-4">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-cogs"></i>
            Ações
          </h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <%= link_to edit_quote_path(quote), class: "btn btn-outline-primary" do %>
              <i class="fas fa-edit"></i> Editar Orçamento
            <% end %>
            
            <% if quote.status == 'pending' %>
              <%= link_to approve_quote_path(quote), method: :patch, 
                  confirm: "Aprovar este orçamento?", class: "btn btn-outline-success" do %>
                <i class="fas fa-check"></i> Aprovar
              <% end %>
              
              <%= link_to reject_quote_path(quote), method: :patch, 
                  confirm: "Rejeitar este orçamento?", class: "btn btn-outline-danger" do %>
                <i class="fas fa-times"></i> Rejeitar
              <% end %>
            <% end %>
            
            <% if quote.status == 'approved' %>
              <%= link_to new_quote_work_order_path(quote), class: "btn btn-outline-success" do %>
                <i class="fas fa-tools"></i> Criar OS
              <% end %>
            <% end %>
            
            <hr>
            
            <%= link_to quote_path(quote), method: :delete, 
                confirm: "Tem certeza que deseja excluir este orçamento?", 
                class: "btn btn-outline-danger" do %>
              <i class="fas fa-trash"></i> Excluir
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 